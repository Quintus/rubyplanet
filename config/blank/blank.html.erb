<!DOCTYPE html>
<%
require "nokogiri"
require "r18n-core"
require "date"

R18n.set("de")
extend R18n::Helpers
%>

<html>
<head>
  <meta charset='utf-8'>
  <meta name='generator' content='<%= Pluto.generator %>'>

  <title><%= site.title %>XXXXX</title>
  <link rel="alternate" type="application/atom+xml" title="Atom-Feed" href="/rubyplanet.feed.atom"/>

  <%= stylesheet_link_tag 'css/font-awesome' %>
  <%= stylesheet_link_tag 'css/blank' %>

  <!-- fix: use script_tag  rails-style ??? -->
  <script src='js/jquery-2.0.3.min.js'></script>
  <script src='js/blank.js'></script>

  <%# = javascript_include_tag 'js/jquery-2.0.3.min.js' %>
  <%# = javascript_include_tag 'js/blank.js' %>

</head>
<body>


<div id='navwrap'>
<div id='nav'>
    <p>Quellen</p>
    <ul class='subscriptions small' >
     <% site.feeds.each do |feed| %>
      <li>
        <%= link_to( image_tag('i/feed-icon-10x10.png'), feed.feed_url ) %>
        <%= link_to feed.title, feed.url %>
      </li>
     <% end %>
     </ul>

    <p>Planetarium</p>
    <ul class='planetarium small'>
      <li><a href='http://plutolive.herokuapp.com'>Internationaler Ruby-Planet</a></li>
      <li><a href='https://planet.archlinux.de'>Planet archlinux.de</a></li>
    </ul>

    <p>Eintragen</p>
    <p class='small'>Wenn auch dein Blog hier erscheinen soll, melde dich bei <a href="mailto:quintus@quintilianus.eu">quintus@quintilianus.eu</a>.</p>
    <p>Meta</p>
    <p class='small'>Erstellt mit <a href="https://www.ruby-lang.org">Ruby</a>, <a href='https://github.com/feedreader'>Pluto</a> und Cron.</p>
    <p class="small"><%= link_to( image_tag('i/feed-icon-10x10.png'), "/rubyplanet.feed.atom" ) %> <%= link_to "Gesamt-Feed", "/rubyplanet.feed.atom" %>
</div>
</div>


<div id='opts'>
  <div style='width: 100%; text-align: right;'>
   <img src='i/view-headlines.png' id='show-headlines' title='Show Headlines Only' width='24' height='24'>
   <img src='i/view-snippets.png' id='show-snippets'    title='Show Snippets' width='24' height='24'>
   <img src='i/view-standard.png' id='show-fulltext'    title='Show Full Text' width='24' height='24'>
  </div>
  <div style='width: 100%; text-align: right;'>
    Stil |
      <%= link_to 'Standard', "#{site.key}.html" %> &bull;
      <%= link_to 'Kartiert', "#{site.key}.cards.html" %>
  </div>
</div>  


<h1><%= site.title %></h1>


<%
   items = site.items.latest.limit(24)
   ItemCursor.new( items ).each do |item, new_date, new_feed|
%>


<% if new_date %>
 <h2 class='new-date'>
  <%= l item.published.to_date, :full %>
 </h2>
<% else %>
  <hr class='item-seperator'>
<% end %>


<article class='item'>

<% if new_feed %>
<h4 class='feed-title'>
  <%= link_to item.feed.title, item.feed.url %>
</h4>
<% end %>


<h3 class='item-title'>
 
 <i class='icon-caret-down item-collapse item-close item-opened'></i>
 <i class='icon-caret-right item-expand item-open item-closed'></i>
 <%= link_to item.title, item.url %>
</h3>

<div class='item-body'>

<div class='item-snippet'>
<% if item.summary %>
  <%= textify( item.summary ) %>
<% elsif item.content %>
  <%=
doc = Nokogiri::HTML(item.content)
doc.xpath("//p").first.to_s
  %>
<% else %>
  -/-
<% end %>
</div>

<div class='item-content item-summary'>
<% if item.content %>
  <%= item.content %>
<% elsif item.summary %>
  <%= textify( item.summary ) %>
<% else %>
  -/-
<% end %>
  
</div>

<div class='item-footer'>
   <%= l item.published, :full %>
</div>

</div><!-- item-body -->

</article><!-- item -->




<% end %><!-- each item -->


</body>
</html>
